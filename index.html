<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ì—° í™•ë¥  ê³„ì‚°ê¸°</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
        }
        /* Custom CSS for a nice gradient button effect */
        .calculate-button {
            background-image: linear-gradient(to right, #f87171 0%, #ef4444 51%, #f87171 100%);
            transition: 0.5s;
            background-size: 200% auto;
            color: white;
            box-shadow: 0 4px 15px 0 rgba(239, 68, 68, 0.75);
        }
        .calculate-button:hover {
            background-position: right center; /* change the direction of the change on hover */
        }
    </style>
</head>
<body class="p-4 sm:p-8 flex items-center justify-center min-h-screen">

    <div id="app" class="w-full max-w-2xl bg-white rounded-xl shadow-2xl p-6 sm:p-10 border border-gray-100">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-red-500 mb-6">ğŸ’– ì¸ì—° í™•ë¥  ê³„ì‚°ê¸° ğŸ’–</h1>
        <p class="text-center text-gray-600 mb-8">ë‘ ë¶„ì˜ ì´ë¦„, ë‚˜ì´, ìƒì¼ì„ ì…ë ¥í•˜ì—¬ ì¬ë¯¸ë¡œ ë³´ëŠ” ì¸ì—° ì ìˆ˜ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!</p>

        <!-- Input Sections -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">

            <!-- Partner 1 (ë‚¨ì) -->
            <div class="bg-blue-50 p-6 rounded-xl shadow-md border-t-4 border-blue-400">
                <h2 class="text-xl font-semibold mb-4 text-blue-700">ğŸ‘¤ íŒŒíŠ¸ë„ˆ 1 (ë‚¨ì)</h2>
                <div class="space-y-4">
                    <!-- ì´ë¦„ -->
                    <div>
                        <label for="name1" class="block text-sm font-medium text-gray-700 mb-1">ì´ë¦„</label>
                        <input type="text" id="name1" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150" placeholder="í™ê¸¸ë™" required>
                    </div>
                    <!-- ë§Œ ë‚˜ì´ -->
                    <div>
                        <label for="age1" class="block text-sm font-medium text-gray-700 mb-1">ë§Œ ë‚˜ì´</label>
                        <input type="number" id="age1" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150" placeholder="30" min="1" required>
                    </div>
                    <!-- ìƒì¼ -->
                    <div>
                        <label for="bday1" class="block text-sm font-medium text-gray-700 mb-1">ìƒì¼ (ì›”/ì¼)</label>
                        <input type="date" id="bday1" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150" required>
                    </div>
                </div>
            </div>

            <!-- Partner 2 (ì—¬ì) -->
            <div class="bg-pink-50 p-6 rounded-xl shadow-md border-t-4 border-pink-400">
                <h2 class="text-xl font-semibold mb-4 text-pink-700">ğŸ‘© íŒŒíŠ¸ë„ˆ 2 (ì—¬ì)</h2>
                <div class="space-y-4">
                    <!-- ì´ë¦„ -->
                    <div>
                        <label for="name2" class="block text-sm font-medium text-gray-700 mb-1">ì´ë¦„</label>
                        <input type="text" id="name2" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500 transition duration-150" placeholder="ì„±ì¶˜í–¥" required>
                    </div>
                    <!-- ë§Œ ë‚˜ì´ -->
                    <div>
                        <label for="age2" class="block text-sm font-medium text-gray-700 mb-1">ë§Œ ë‚˜ì´</label>
                        <input type="number" id="age2" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500 transition duration-150" placeholder="28" min="1" required>
                    </div>
                    <!-- ìƒì¼ -->
                    <div>
                        <label for="bday2" class="block text-sm font-medium text-gray-700 mb-1">ìƒì¼ (ì›”/ì¼)</label>
                        <input type="date" id="bday2" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500 transition duration-150" required>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calculate Button -->
        <button id="calculateBtn" class="calculate-button w-full text-lg font-bold py-4 rounded-full mt-4 hover:scale-[1.01] transition duration-300">
            âœ¨ ì¸ì—° í™•ë¥  ê³„ì‚°í•˜ê¸° âœ¨
        </button>

        <!-- Result Section -->
        <div id="result" class="mt-8 pt-6 border-t border-gray-200 hidden">
            <h3 class="text-2xl font-bold text-center mb-4 text-gray-800">ì¸¡ì • ê²°ê³¼</h3>
            <div id="probabilityDisplay" class="text-5xl font-extrabold text-center text-red-600 mb-4"></div>
            <p id="messageDisplay" class="text-lg text-center text-gray-700"></p>
            <div id="scoreDetails" class="mt-4 p-4 bg-gray-50 rounded-lg text-sm text-gray-600"></div>
        </div>

        <!-- Custom Modal for Errors (Replaces alert()) -->
        <div id="modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
            <div class="relative p-5 border w-96 shadow-lg rounded-md bg-white">
                <h3 class="text-lg font-bold text-red-500 mb-3">âš ï¸ ì˜¤ë¥˜</h3>
                <p id="modalMessage" class="text-gray-700 mb-4"></p>
                <button onclick="document.getElementById('modal').classList.add('hidden')" class="w-full py-2 px-4 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition duration-150">í™•ì¸</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK Imports (required for all interactive applications) -->
    <script type="module">
        // Firebase Configuration and Imports (Standard setup boilerplate)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // IMPORTANT: Global variables provided by the Canvas environment MUST be used.
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        let firebaseConfig = {};
        if (typeof __firebase_config !== 'undefined' && __firebase_config) {
            try {
                firebaseConfig = JSON.parse(__firebase_config);
            } catch (e) {
                console.error("Failed to parse firebase config:", e);
            }
        }
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app, db, auth;
        setLogLevel('Debug'); // Enable Firestore logging

        // Initialize Firebase and Authenticate
        async function initializeFirebase() {
            if (Object.keys(firebaseConfig).length === 0) {
                console.warn("Firebase config is empty. Skipping initialization.");
                return;
            }

            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                const userId = auth.currentUser?.uid || crypto.randomUUID();
                console.log("Firebase initialized. User ID:", userId);

            } catch (error) {
                console.error("Firebase initialization or sign-in failed:", error);
            }
        }

        // --- Core Application Logic (Outside of Firebase init) ---

        // Helper function for the custom error modal
        function showModal(message) {
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('modal').classList.remove('hidden');
        }

        // 1. ì´ë¦„ ê¶í•© ì ìˆ˜ ê³„ì‚° (ìµœëŒ€ 40ì )
        function calculateNameScore(name1, name2) {
            let score = 0;
            const cleanName1 = name1.replace(/\s+/g, '').toLowerCase();
            const cleanName2 = name2.replace(/\s+/g, '').toLowerCase();

            // A. ê¸¸ì´ ì°¨ì´ í˜ë„í‹° (ìµœëŒ€ 20ì )
            const lengthDiff = Math.abs(cleanName1.length - cleanName2.length);
            score += Math.max(0, 20 - lengthDiff * 2); // 10ì ì°¨ì´ë‚˜ë©´ 0ì , ê°™ìœ¼ë©´ 20ì .

            // B. ê³µí†µ ê¸€ì ì ìˆ˜ (ìµœëŒ€ 20ì ) - í•œê¸€ ìëª¨ëŠ” ë³µì¡í•˜ë¯€ë¡œ, ë‹¨ìˆœ ê¸€ì(ìŒì ˆ) ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°
            const set1 = new Set(cleanName1.split(''));
            const set2 = new Set(cleanName2.split(''));
            let sharedCount = 0;
            set1.forEach(char => {
                if (set2.has(char)) {
                    sharedCount++;
                }
            });

            const maxLen = Math.max(cleanName1.length, cleanName2.length);
            if (maxLen > 0) {
                 // ìµœëŒ€ 20ì . ì´ë¦„ì´ ê¸¸ìˆ˜ë¡ sharedCountê°€ ë†’ì•„ì•¼ ì ìˆ˜ê°€ ë†’ìŒ.
                score += Math.min(20, Math.floor((sharedCount / maxLen) * 20));
            }

            return Math.round(Math.min(40, score));
        }

        // 2. ë‚˜ì´ ê¶í•© ì ìˆ˜ ê³„ì‚° (ìµœëŒ€ 30ì )
        function calculateAgeScore(age1, age2) {
            const ageDiff = Math.abs(age1 - age2);
            let score = 0;

            if (ageDiff === 0) {
                score = 30; // ë‚˜ì´ê°€ ê°™ìœ¼ë©´ ìµœê³  ì ìˆ˜
            } else if (ageDiff <= 3) {
                score = 25 - (ageDiff * 5); // 1~3ì‚´ ì°¨ì´: 20, 15, 10ì 
            } else if (ageDiff <= 7) {
                score = 10; // 4~7ì‚´ ì°¨ì´: 10ì 
            } else {
                score = 5; // 8ì‚´ ì´ìƒ ì°¨ì´: 5ì 
            }

            return Math.round(score);
        }

        // 3. ìƒì¼ ê¶í•© ì ìˆ˜ ê³„ì‚° (ìµœëŒ€ 30ì )
        function calculateBdayScore(bdayStr1, bdayStr2) {
            // bdayStr format: YYYY-MM-DD
            try {
                const date1 = new Date(bdayStr1);
                const date2 = new Date(bdayStr2);

                const month1 = date1.getMonth() + 1; // 1-12
                const day1 = date1.getDate(); // 1-31
                const month2 = date2.getMonth() + 1;
                const day2 = date2.getDate();

                // ìˆ«ìë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ê³  ëª¨ë“  ìë¦¿ìˆ˜ë¥¼ ë”í•˜ëŠ” í•¨ìˆ˜ (ex: 12 -> 1+2=3, 29 -> 2+9=11)
                const sumDigits = (num) => String(num).split('').reduce((sum, digit) => sum + parseInt(digit), 0);

                const sum1 = sumDigits(month1) + sumDigits(day1);
                const sum2 = sumDigits(month2) + sumDigits(day2);

                const diff = Math.abs(sum1 - sum2);

                // ì ìˆ˜: ì°¨ì´ê°€ ì‘ì„ìˆ˜ë¡ ê³ ë“ì  (ìµœëŒ€ ì°¨ì´: 9+9+9+9 = 36)
                // 30ì  ë§Œì ì—ì„œ ì°¨ì´ * 1.5 ë§Œí¼ ê°ì  (ìµœì†Œ 0ì )
                const score = Math.max(0, 30 - diff * 1.5);

                return Math.round(score);
            } catch (e) {
                console.error("Birthday calculation error:", e);
                return 0;
            }
        }

        // ë©”ì¸ ê³„ì‚° í•¨ìˆ˜
        function calculateLoveProbability() {
            const name1 = document.getElementById('name1').value.trim();
            const age1 = parseInt(document.getElementById('age1').value, 10);
            const bday1 = document.getElementById('bday1').value;

            const name2 = document.getElementById('name2').value.trim();
            const age2 = parseInt(document.getElementById('age2').value, 10);
            const bday2 = document.getElementById('bday2').value;

            // ìœ íš¨ì„± ê²€ì‚¬
            if (!name1 || !name2 || isNaN(age1) || isNaN(age2) || !bday1 || !bday2) {
                showModal("ëª¨ë“  í•­ëª© (ì´ë¦„, ë‚˜ì´, ìƒì¼)ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            if (age1 <= 0 || age2 <= 0) {
                showModal("ë‚˜ì´ëŠ” 1ì‚´ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
                return;
            }

            // 1. ì ìˆ˜ ê³„ì‚°
            const nameScore = calculateNameScore(name1, name2);
            const ageScore = calculateAgeScore(age1, age2);
            const bdayScore = calculateBdayScore(bday1, bday2);

            const totalScore = nameScore + ageScore + bdayScore; // Max is 40 + 30 + 30 = 100

            // 2. ìµœì¢… í™•ë¥  (100ì  ë§Œì ì´ë¯€ë¡œ ê·¸ëŒ€ë¡œ í™•ë¥  %)
            const probability = Math.min(100, Math.max(0, totalScore));

            // 3. ë©”ì‹œì§€ ìƒì„±
            let message = '';
            let emoji = '';
            if (probability >= 85) {
                message = `ğŸ‰ ì™€ìš°! ${probability}%! ìš´ëª…ì ì¸ ë§Œë‚¨ì…ë‹ˆë‹¤! í•˜ëŠ˜ì´ ë§ºì–´ì¤€ ì¸ì—°ì¼ì§€ë„ ëª°ë¼ìš”.`;
                emoji = 'ğŸ˜';
            } else if (probability >= 70) {
                message = `ğŸ˜Š ${probability}%! ì•„ì£¼ ë†’ì€ í™•ë¥ ì…ë‹ˆë‹¤! ì„œë¡œì—ê²Œ ì¢‹ì€ ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆëŠ” ì™„ë²½í•œ ì¡°í•©ì´ë„¤ìš”.`;
                emoji = 'ğŸ¥°';
            } else if (probability >= 50) {
                message = `ğŸ™‚ ${probability}%! ì ˆë°˜ ì´ìƒì˜ í™•ë¥ ! ë…¸ë ¥í•œë‹¤ë©´ ì¶©ë¶„íˆ ì¢‹ì€ ê´€ê³„ë¡œ ë°œì „í•  ìˆ˜ ìˆì–´ìš”.`;
                emoji = 'ğŸ˜Š';
            } else if (probability >= 30) {
                message = `ğŸ¤” ${probability}%! ì¡°ê¸ˆì€ ë¶€ì¡±í•˜ì§€ë§Œ, ì¸ì—°ì€ ë§Œë“¤ì–´ê°€ëŠ” ê²ƒì´ì£ ! í¬ë§ì„ ê°€ì§€ì„¸ìš”!`;
                emoji = 'ğŸ™‚';
            } else {
                message = `ğŸ˜… ${probability}%! ë‚®ì€ í™•ë¥ ì´ì§€ë§Œ, ì´ ì ìˆ˜ëŠ” ë‹¨ìˆœí•œ ì¬ë¯¸ì¼ ë¿ì…ë‹ˆë‹¤. ì§„ì‹¬ì´ ì¤‘ìš”í•´ìš”!`;
                emoji = 'ğŸ˜‰';
            }

            // 4. ê²°ê³¼ ì¶œë ¥
            const probabilityDisplay = document.getElementById('probabilityDisplay');
            const messageDisplay = document.getElementById('messageDisplay');
            const scoreDetails = document.getElementById('scoreDetails');
            const resultSection = document.getElementById('result');

            probabilityDisplay.innerHTML = `${emoji} ${probability}%`;
            messageDisplay.textContent = message;

            scoreDetails.innerHTML = `
                <h4 class="font-semibold text-gray-800 mb-2">ì„¸ë¶€ ì ìˆ˜ (ì´ì  100ì )</h4>
                <ul class="list-disc list-inside space-y-1">
                    <li><span class="font-bold text-blue-600">ì´ë¦„ ê¶í•©:</span> ${nameScore}ì  (ìµœëŒ€ 40ì )</li>
                    <li><span class="font-bold text-red-600">ë‚˜ì´ ê¶í•©:</span> ${ageScore}ì  (ìµœëŒ€ 30ì )</li>
                    <li><span class="font-bold text-green-600">ìƒì¼ ê¶í•©:</span> ${bdayScore}ì  (ìµœëŒ€ 30ì )</li>
                </ul>
            `;

            resultSection.classList.remove('hidden');
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        document.getElementById('calculateBtn').addEventListener('click', calculateLoveProbability);

        // Firebase ì´ˆê¸°í™” í˜¸ì¶œ
        initializeFirebase();
    </script>
</body>
</html>
